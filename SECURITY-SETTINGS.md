# ğŸ”’ SÃ©curitÃ© & AccÃ¨s - Documentation

## âœ… Ã‰cran CrÃ©Ã©

La page **Security Settings** est maintenant disponible ! ğŸ‰

---

## ğŸ¨ Design System AppliquÃ©

### Couleurs
- **Fond** : `bg-slate-950` (#020617)
- **Cartes** : `bg-slate-900` (#0f172a)
- **Bordures** : `border-slate-800` (#1e293b)
- **IcÃ´nes actives** : `text-yellow-400` (#facc15)
- **Zone danger** : `text-red-500` + `border-red-500/30`
- **Switch ON** : `bg-yellow-400`

---

## ğŸ“± Structure de l'Ã‰cran

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† SÃ©curitÃ© & AccÃ¨s                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  AUTHENTIFICATION                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ” Connexion biomÃ©trique ğŸŸ¡â”‚   â”‚
â”‚  â”‚ Se connecter sans mot...    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  MOT DE PASSE                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”’ Modifier mon mot de passe>â”‚   â”‚
â”‚  â”‚ DerniÃ¨re modif il y a 3 moisâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  SÃ‰CURITÃ‰ TRAJET                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“± Contact d'urgence (SOS)  >â”‚   â”‚
â”‚  â”‚ Personne Ã  prÃ©venir...      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ›¡ï¸ Code PIN de vÃ©rification >â”‚   â”‚
â”‚  â”‚ Demander un code au client..â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ZONE DE DANGER                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âš ï¸ Supprimer mon compte     >â”‚   â”‚
â”‚  â”‚ Cette action est irrÃ©versibleâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ğŸ”’ Vos donnÃ©es sont chiffrÃ©es...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ FonctionnalitÃ©s

### 1ï¸âƒ£ **Authentification**

#### Connexion BiomÃ©trique
- **Switch** : ON/OFF
- **Ã‰tat** : GÃ©rÃ© par `useState`
- **Toast** : Confirmation Ã  chaque changement
- **Future** : IntÃ©gration avec `expo-local-authentication` (web : WebAuthn)

```tsx
const [biometricEnabled, setBiometricEnabled] = useState(false);

const toggleBiometric = () => {
  setBiometricEnabled(!biometricEnabled);
  toast({
    title: biometricEnabled ? 'BiomÃ©trie dÃ©sactivÃ©e' : 'BiomÃ©trie activÃ©e',
    description: '...',
  });
};
```

---

### 2ï¸âƒ£ **Mot de Passe**

#### Modifier mon mot de passe
- **Action** : Navigation vers `/security/change-password`
- **Info** : "DerniÃ¨re modification il y a 3 mois"
- **IcÃ´ne** : Cadenas jaune

```tsx
const handleChangePassword = () => {
  navigate('/security/change-password');
};
```

---

### 3ï¸âƒ£ **SÃ©curitÃ© Trajet**

#### Contact d'urgence (SOS)
- **Description** : Personne Ã  prÃ©venir en cas d'incident
- **Action** : Toast "BientÃ´t disponible"
- **Future** : Formulaire pour ajouter un contact

#### Code PIN de vÃ©rification
- **Description** : Demander un code au client avant la course
- **Action** : Toast "BientÃ´t disponible"
- **Future** : Activation/DÃ©sactivation du PIN

---

### 4ï¸âƒ£ **Zone de Danger**

#### Supprimer mon compte
- **Style** : Bordure rouge + texte rouge
- **Action** : Ouvre un **AlertDialog** de confirmation
- **Confirmation** : 2 boutons (Annuler / Confirmer)
- **Effet** : Suppression + Redirection vers login

```tsx
const [showDeleteDialog, setShowDeleteDialog] = useState(false);

const handleDeleteAccount = () => {
  setShowDeleteDialog(false);
  toast({
    title: 'Compte supprimÃ©',
    description: 'Votre compte a Ã©tÃ© supprimÃ© avec succÃ¨s',
    variant: 'destructive',
  });
  setTimeout(() => {
    navigate('/login');
  }, 2000);
};
```

---

## ğŸ¨ AlertDialog de Suppression

```tsx
<AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
  <AlertDialogContent className="bg-slate-900 border-slate-800">
    <AlertDialogHeader>
      <AlertDialogTitle className="text-white">
        Supprimer votre compte ?
      </AlertDialogTitle>
      <AlertDialogDescription className="text-slate-400">
        Cette action est <span className="text-red-500 font-semibold">irrÃ©versible</span>. 
        Toutes vos donnÃ©es seront dÃ©finitivement supprimÃ©es.
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel>Annuler</AlertDialogCancel>
      <AlertDialogAction onClick={handleDeleteAccount} className="bg-red-500">
        Confirmer la suppression
      </AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

---

## ğŸ”— Navigation

### Depuis Profile
```tsx
// Dans Profile.tsx
if (action === 'security') {
  navigate('/security');
  return;
}
```

### Route
```tsx
// Dans App.tsx
<Route path="/security" element={
  <ProtectedRoute>
    <SecuritySettings />
  </ProtectedRoute>
} />
```

---

## ğŸ“Š IntÃ©gration Future

### BiomÃ©trie Web (WebAuthn)

```tsx
// Pour le web, utiliser WebAuthn API
const enableBiometric = async () => {
  if (!window.PublicKeyCredential) {
    toast({
      title: 'Non supportÃ©',
      description: 'Votre navigateur ne supporte pas la biomÃ©trie',
      variant: 'destructive',
    });
    return;
  }

  try {
    const credential = await navigator.credentials.create({
      publicKey: {
        challenge: new Uint8Array(32),
        rp: { name: "One Connexion" },
        user: {
          id: new Uint8Array(16),
          name: driver?.email || '',
          displayName: `${driver?.first_name} ${driver?.last_name}`,
        },
        pubKeyCredParams: [{ alg: -7, type: "public-key" }],
        authenticatorSelection: {
          authenticatorAttachment: "platform",
          userVerification: "required",
        },
      },
    });

    // Save credential to backend
    setBiometricEnabled(true);
  } catch (error) {
    console.error('Biometric setup failed:', error);
  }
};
```

### Suppression de Compte (Supabase)

```tsx
const handleDeleteAccount = async () => {
  try {
    // 1. Delete all driver data
    const { error: dataError } = await supabase
      .from('drivers')
      .delete()
      .eq('id', driver?.id);

    if (dataError) throw dataError;

    // 2. Delete auth user
    const { error: authError } = await supabase.auth.admin.deleteUser(
      driver?.id
    );

    if (authError) throw authError;

    // 3. Logout and redirect
    logout();
    navigate('/login');
  } catch (error) {
    console.error('Error deleting account:', error);
    toast({
      title: 'Erreur',
      description: 'Impossible de supprimer le compte',
      variant: 'destructive',
    });
  }
};
```

---

## ğŸ§ª Tester

Le serveur est lancÃ© sur **http://localhost:8080**

1. **Connecte-toi** (auto-login âœ…)
2. **Va sur Profile**
3. **Clique sur "SÃ©curitÃ©"**
4. **Teste les fonctionnalitÃ©s** :
   - Toggle biomÃ©trie (switch jaune)
   - Clique sur "Modifier mot de passe"
   - Clique sur "Contact d'urgence"
   - Clique sur "Code PIN"
   - Clique sur "Supprimer mon compte" (dialog rouge)

---

## âœ¨ Points Forts

- âœ… **Design cohÃ©rent** avec le reste de l'app
- âœ… **4 sections claires** (Auth, Mot de passe, SÃ©curitÃ© trajet, Danger)
- âœ… **Switch jaune** pour la biomÃ©trie
- âœ… **AlertDialog** pour la suppression critique
- âœ… **IcÃ´nes colorÃ©es** (jaune pour actif, rouge pour danger)
- âœ… **Toast de confirmation** pour chaque action
- âœ… **Zone de danger** visuellement distincte
- âœ… **Info footer** pour rassurer l'utilisateur

---

## ğŸ“‹ Checklist

- [x] Page crÃ©Ã©e (`SecuritySettings.tsx`)
- [x] Route ajoutÃ©e (`/security`)
- [x] Navigation depuis Profile
- [x] Design dark appliquÃ©
- [x] Switch biomÃ©trie fonctionnel
- [x] AlertDialog de suppression
- [x] 4 sections organisÃ©es
- [ ] Page "Change Password" (Ã  crÃ©er)
- [ ] IntÃ©gration WebAuthn (Ã  faire)
- [ ] IntÃ©gration Supabase (Ã  faire)

---

**Page de sÃ©curitÃ© terminÃ©e ! ğŸ”’âœ¨**
