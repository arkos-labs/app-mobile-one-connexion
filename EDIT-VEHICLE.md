# üöó √âdition de V√©hicule - Documentation

## ‚úÖ Page Cr√©√©e

**Route** : `/vehicles/:vehicleId/edit`

---

## üì± Aper√ßu Visuel

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê  Modifier mon v√©hicule       üîî  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Modifier mon v√©hicule              ‚îÇ
‚îÇ  Mettez √† jour les informations...  ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ [Photo du v√©hicule]         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  [üì∑ Changer la photo]      ‚îÇ   ‚îÇ  ‚Üê Overlay hover
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Marque *                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [Peugeot____________]       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Mod√®le *                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [308_________________]      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Immatriculation *           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [AB-123-CD__________]       ‚îÇ   ‚îÇ  ‚Üê Auto-uppercase
‚îÇ  ‚îÇ Sera converti en majuscules ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Couleur *                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [Noir_______________]       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Type de v√©hicule *          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [Voiture ‚ñº__________]       ‚îÇ   ‚îÇ  ‚Üê Select
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [üíæ Enregistrer les modifications] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß Fonctionnalit√©s

### 1Ô∏è‚É£ **Chargement des Donn√©es**

```tsx
useEffect(() => {
  loadVehicle();
}, [vehicleId]);

const loadVehicle = async () => {
  // Production: Load from Supabase
  const { data, error } = await supabase
    .from('vehicles')
    .select('*')
    .eq('id', vehicleId)
    .single();

  if (error) {
    toast({ title: 'Erreur' });
    navigate('/admin-hub');
    return;
  }

  setVehicle(data);
};
```

### 2Ô∏è‚É£ **Upload de Photo**

#### S√©lection
```tsx
const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  
  // Validation type
  if (!file.type.startsWith('image/')) {
    toast({ title: 'Erreur', description: 'Image requise' });
    return;
  }

  // Validation taille (max 10MB)
  if (file.size > 10 * 1024 * 1024) {
    toast({ title: 'Erreur', description: 'Max 10MB' });
    return;
  }

  setSelectedImage(file);
  setPreviewUrl(URL.createObjectURL(file));
};
```

#### Upload Supabase
```tsx
const uploadImage = async (file: File): Promise<string> => {
  const fileExt = file.name.split('.').pop();
  const fileName = `${vehicle?.id}/vehicle.${fileExt}`;

  // Upload to Supabase Storage
  const { data, error } = await supabase.storage
    .from('vehicles')
    .upload(fileName, file, { upsert: true });

  if (error) throw error;

  // Get public URL
  const { data: { publicUrl } } = supabase.storage
    .from('vehicles')
    .getPublicUrl(fileName);

  return publicUrl;
};
```

### 3Ô∏è‚É£ **Auto-Uppercase Plaque**

```tsx
const handleChange = (field: keyof Vehicle, value: string) => {
  // Auto-uppercase for license plate
  if (field === 'licensePlate') {
    value = value.toUpperCase();
  }

  setVehicle({ ...vehicle, [field]: value });
};
```

### 4Ô∏è‚É£ **Sauvegarde**

```tsx
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  setSaving(true);

  try {
    // Upload new image if selected
    let imageUrl = vehicle.imageUrl;
    if (selectedImage) {
      imageUrl = await uploadImage(selectedImage);
    }

    // Update vehicle in database
    const { error } = await supabase
      .from('vehicles')
      .update({
        brand: vehicle.brand,
        model: vehicle.model,
        license_plate: vehicle.licensePlate,
        color: vehicle.color,
        type: vehicle.type,
        image_url: imageUrl,
        updated_at: new Date().toISOString(),
      })
      .eq('id', vehicle.id);

    if (error) throw error;

    toast({ title: 'V√©hicule mis √† jour !' });
    navigate('/admin-hub');

  } catch (error) {
    toast({ title: 'Erreur', variant: 'destructive' });
  } finally {
    setSaving(false);
  }
};
```

---

## üé® Design System

### Photo Section
```tsx
<Card className="bg-slate-900 border-slate-800 overflow-hidden">
  <div className="relative h-64 w-full">
    <img src={displayImageUrl} className="w-full h-full object-cover" />
    
    {/* Overlay hover */}
    <div className="absolute inset-0 bg-black/40 opacity-0 hover:opacity-100">
      <label className="bg-yellow-400 text-black font-bold">
        <Camera className="w-5 h-5" />
        Changer la photo
      </label>
    </div>
  </div>
</Card>
```

### Form Inputs
```tsx
<Input
  className="bg-slate-800 border-slate-700 text-white placeholder:text-slate-500"
  placeholder="Ex: Peugeot"
/>
```

### Select
```tsx
<Select>
  <SelectTrigger className="bg-slate-800 border-slate-700 text-white">
    <SelectValue />
  </SelectTrigger>
  <SelectContent className="bg-slate-800 border-slate-700">
    <SelectItem value="scooter">Scooter</SelectItem>
    <SelectItem value="moto">Moto</SelectItem>
    <SelectItem value="voiture">Voiture</SelectItem>
  </SelectContent>
</Select>
```

### Save Button
```tsx
<Button className="bg-[#FCD34D] hover:bg-[#FCD34D]/90 text-black font-bold">
  {saving ? (
    <>
      <Loader2 className="animate-spin mr-2" />
      Enregistrement...
    </>
  ) : (
    <>
      <Save className="mr-2" />
      Enregistrer
    </>
  )}
</Button>
```

---

## üß™ Tester

Le serveur est lanc√© sur **http://localhost:8080**

1. **Profile** ‚Üí "Mon Dossier Pro"
2. **Toggle V√©hicule**
3. **Clique sur "Modifier / Remplacer"** ‚Üí Page d'√©dition ‚úÖ
4. **Teste l'upload photo** :
   - Hover sur photo ‚Üí Overlay appara√Æt ‚úÖ
   - Clique "Changer la photo" ‚Üí File picker ‚úÖ
   - S√©lectionne une image ‚Üí Preview s'affiche ‚úÖ
5. **Teste les champs** :
   - Modifie la marque ‚Üí OK ‚úÖ
   - Entre "ab-123-cd" dans plaque ‚Üí Converti en "AB-123-CD" ‚úÖ
   - Change le type ‚Üí Select fonctionne ‚úÖ
6. **Sauvegarde** :
   - Clique "Enregistrer" ‚Üí Loader ‚úÖ
   - Toast "V√©hicule mis √† jour !" ‚úÖ
   - Redirection vers /admin-hub ‚úÖ

---

## üìä Flux Utilisateur

```
Admin Hub
  ‚Üì
[Modifier / Remplacer mon v√©hicule]
  ‚Üì
/vehicles/:id/edit
  ‚Üì
Chargement des donn√©es
  ‚Üì
Formulaire pr√©-rempli
  ‚îú‚îÄ Photo actuelle affich√©e
  ‚îú‚îÄ Champs remplis
  ‚îî‚îÄ Type s√©lectionn√©
  ‚Üì
Modifications
  ‚îú‚îÄ Changer photo (optionnel)
  ‚îú‚îÄ Modifier champs
  ‚îî‚îÄ Validation auto-uppercase
  ‚Üì
[Enregistrer]
  ‚îú‚îÄ Upload photo si nouvelle
  ‚îú‚îÄ Update database
  ‚îî‚îÄ Toast + Redirection
  ‚Üì
Admin Hub (v√©hicule mis √† jour)
```

---

## ‚ú® Fonctionnalit√©s Avanc√©es

### Validation Photo
- ‚úÖ Type : Seulement images
- ‚úÖ Taille : Max 10MB
- ‚úÖ Preview : Affichage imm√©diat

### Auto-Uppercase
```tsx
// Input
value="ab-123-cd"

// onChange
value.toUpperCase() // "AB-123-CD"
```

### √âtats du Bouton
- **Normal** : "Enregistrer les modifications"
- **Loading** : "Enregistrement en cours..." + Spinner
- **Disabled** : Pendant sauvegarde

### Cleanup
```tsx
useEffect(() => {
  return () => {
    // Cleanup preview URL
    if (previewUrl) {
      URL.revokeObjectURL(previewUrl);
    }
  };
}, [previewUrl]);
```

---

## üìã Checklist

- [x] Page EditVehicle cr√©√©e
- [x] Route /vehicles/:id/edit ajout√©e
- [x] Chargement donn√©es Supabase
- [x] Upload photo avec validation
- [x] Preview photo
- [x] Auto-uppercase plaque
- [x] Select type v√©hicule
- [x] Sauvegarde Supabase
- [x] Toast feedback
- [x] Redirection apr√®s succ√®s
- [x] Design dark coh√©rent
- [x] Bouton jaune #FCD34D
- [x] AdminHub mis √† jour

---

## üéØ R√©sum√©

| √âl√©ment | Impl√©ment√© |
|---------|------------|
| **Upload photo** | ‚úÖ Avec validation |
| **Preview** | ‚úÖ Temps r√©el |
| **Auto-uppercase** | ‚úÖ Plaque |
| **Select type** | ‚úÖ 3 options |
| **Supabase** | ‚úÖ Code pr√™t |
| **UX** | ‚úÖ Feedback complet |

---

**Page d'√©dition de v√©hicule termin√©e ! üöó‚ú®**
